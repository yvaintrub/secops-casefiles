# ğŸ›¡ Demo Case: AWS IAM Key Abuse & S3 Exfiltration (Anonymized)

## ğŸ“Œ Executive Summary
This case describes an **AWS cloud breach** where exposed IAM access keys were abused.  
The attacker enumerated the environment, escalated privileges by attaching new policies, and exfiltrated data from S3 buckets.  
Persistence was achieved via creation of a new IAM user with admin rights.  

**ğŸ¯ Outcome:** confirmed cloud credential theft, privilege escalation, data exfiltration, and persistence.

---

## ğŸ–¼ Attack Flow (ASCII Diagram)

+--------------------------+
| External Attacker        |
| (Leaked IAM Keys)        |
+--------------------------+
             |
             v
+--------------------------+
| AWS STS AssumeRole       |
| (Initial Access)         |
+--------------------------+
             |
             v
+--------------------------+
| Reconnaissance           |
| - ListBuckets            |
| - DescribeInstances      |
+--------------------------+
             |
             v
+--------------------------+
| Privilege Escalation     |
| AttachUserPolicy: Admin  |
+--------------------------+
             |
             v
+--------------------------+
| Data Exfiltration        |
| S3 sync â†’ External Host  |
+--------------------------+
             |
             v
+--------------------------+
| Persistence              |
| New IAM User Created     |
+--------------------------+

---

## ğŸ“– Attack Narrative

### Stage 1 â€“ Initial Access
- ğŸ”´ Exposed IAM access keys harvested from GitHub repo.  
- ğŸŸ¡ Used **AWS STS AssumeRole** to authenticate.  

### Stage 2 â€“ Reconnaissance
- ğŸ”´ Enumerated resources with `aws s3 ls`, `aws ec2 describe-instances`.  
- ğŸŸ¡ Identified sensitive S3 buckets containing logs & customer data.  

### Stage 3 â€“ Privilege Escalation
- ğŸ”´ Attacker called `AttachUserPolicy` to grant **AdministratorAccess**.  

### Stage 4 â€“ Exfiltration & Persistence
- ğŸ”´ Ran `aws s3 sync s3://sensitive-bucket ./dump` â†’ copied externally.  
- ğŸŸ¡ Created new IAM user `sys-backup` with admin rights for persistence.  

---

## â±ï¸ Timeline (UTC)

| Time   | Event                                               |
|--------|-----------------------------------------------------|
| 14:02  | ğŸ”´ IAM keys leaked & attacker authenticated         |
| 14:15  | ğŸŸ¡ Recon: `aws s3 ls` + `describe-instances`         |
| 14:30  | ğŸ”´ Privilege escalation: `AttachUserPolicy` â†’ Admin  |
| 14:50  | ğŸ”´ Exfiltration: S3 sync executed                    |
| 15:05  | ğŸŸ¡ New IAM user `sys-backup` created (persistence)   |

---

## ğŸ”‘ Key Findings
- IAM keys exposed in public repo â†’ attacker gained entry.  
- Privilege escalation via policy attachment allowed full control.  
- Data exfiltrated from S3 within 1 hour of compromise.  
- Persistence maintained by creating rogue IAM user.  

---

## ğŸ—‚ï¸ MITRE ATT&CK Mapping
- **T1078.004 â€“ Valid Accounts: Cloud Accounts**  
- **T1087 â€“ Account Discovery (Cloud)**  
- **T1485 â€“ Data Destruction / Exfiltration (S3 sync)**  
- **T1136.003 â€“ Create Account (IAM User)**  
- **T1098 â€“ Account Manipulation (Policy Attachment)**  

---

## ğŸ‘€ Detection Use Cases
- ğŸš¨ Alert on IAM keys used from new geographies.  
- Detect `AttachUserPolicy` granting **Admin** rights.  
- Monitor large-volume `aws s3 sync` or `GetObject` calls.  
- Watch for creation of new IAM users by non-admin roles.  

---

## ğŸ›¡ï¸ Recommendations
- Enforce IAM key rotation & use short-lived credentials.  
- Block IAM policy modifications outside change windows.  
- Monitor S3 access patterns & enable GuardDuty.  
- Enforce least-privilege IAM policies & MFA for console access.  
- Automate detection of exposed keys in public repos (e.g., GitHub).  
