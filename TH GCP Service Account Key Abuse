# ğŸ›¡ Demo Case: GCP Service Account Key Abuse (Anonymized)

## ğŸ“Œ Executive Summary
This case describes a **GCP compromise** where a leaked **service account key** was abused.  
The attacker authenticated directly to Google Cloud APIs, escalated privileges by impersonating other service accounts, and accessed sensitive GCS buckets.  
Persistence was achieved by creating a new service account with **Owner** role.  

**ğŸ¯ Outcome:** confirmed cloud credential theft, privilege escalation, sensitive data exfiltration, and persistence.

---

## ğŸ–¼ Attack Flow (ASCII Diagram)

+----------------------------+
| External Attacker          |
| (Leaked GCP SA Key)        |
+----------------------------+
             |
             v
+----------------------------+
| gcloud auth activate       |
| (Initial Access)           |
+----------------------------+
             |
             v
+----------------------------+
| Reconnaissance             |
| - gcloud projects list     |
| - gcloud storage buckets   |
+----------------------------+
             |
             v
+----------------------------+
| Privilege Escalation       |
| Service Account Imperson.  |
| â†’ Owner Role               |
+----------------------------+
             |
             v
+----------------------------+
| Data Exfiltration          |
| gsutil cp GCS â†’ External   |
+----------------------------+
             |
             v
+----------------------------+
| Persistence                |
| New SA Key w/ Owner Role   |
+----------------------------+

---

## ğŸ“– Attack Narrative

### Stage 1 â€“ Initial Access
- ğŸ”´ Leaked **service account JSON key** discovered in public GitHub repo.  
- ğŸŸ¡ Attacker used `gcloud auth activate-service-account --key-file=key.json`.  

### Stage 2 â€“ Reconnaissance
- ğŸ”´ Enumerated project IDs with `gcloud projects list`.  
- ğŸŸ¡ Listed GCS buckets: `gcloud storage buckets list`.  

### Stage 3 â€“ Privilege Escalation
- ğŸ”´ Abused **Service Account Impersonation** to escalate to `roles/owner`.  

### Stage 4 â€“ Exfiltration & Persistence
- ğŸ”´ Exfiltrated bucket data: `gsutil -m cp -r gs://sensitive-bucket ./loot`.  
- ğŸŸ¡ Created **new service account** + key with `roles/owner` for persistence.  

---

## â±ï¸ Timeline (UTC)

| Time   | Event                                                   |
|--------|---------------------------------------------------------|
| 11:05  | ğŸ”´ SA key used for authentication                       |
| 11:15  | ğŸŸ¡ Recon: listed projects and storage buckets            |
| 11:30  | ğŸ”´ Service account impersonation â†’ Owner role            |
| 11:45  | ğŸ”´ Exfiltration: GCS data copied externally              |
| 12:10  | ğŸŸ¡ New SA + Owner role created for persistence            |

---

## ğŸ”‘ Key Findings
- Service account key exposed in public repo.  
- Attacker escalated via **SA impersonation**.  
- Sensitive data exfiltrated from Google Cloud Storage.  
- Persistence maintained via new **rogue SA with Owner role**.  

---

## ğŸ—‚ï¸ MITRE ATT&CK Mapping
- **T1552.001 â€“ Unsecured Credentials (Exposed Keys)**  
- **T1078.004 â€“ Valid Accounts: Cloud Accounts**  
- **T1098 â€“ Account Manipulation (SA Impersonation)**  
- **T1530 â€“ Data Exfiltration from Cloud Storage**  
- **T1136.003 â€“ Create Account (New Service Account)**  

---

## ğŸ‘€ Detection Use Cases
- ğŸš¨ Alert on usage of service account keys from unknown IPs.  
- Detect `gcloud auth activate-service-account` executions.  
- Monitor **SA impersonation** calls â†’ privilege escalation.  
- Alert on creation of new service accounts with `roles/owner`.  
- Detect large-volume `gsutil cp` activity to external destinations.  

---

## ğŸ›¡ï¸ Recommendations
- Rotate & revoke leaked service account keys immediately.  
- Use **Workload Identity Federation** instead of long-lived keys.  
- Restrict **SA impersonation** to least privilege.  
- Enable **Cloud Audit Logs** for SA activity.  
- Implement DLP & monitoring for GCS bucket exfiltration.  
