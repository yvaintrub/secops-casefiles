# â˜ï¸ Demo Case: Cloud Credential Abuse via AWS Lambda (Anonymized)

## ğŸ“Œ Executive Summary
This case describes a **cloud-focused compromise**.  
The attacker obtained exposed **AWS Lambda credentials**, used them to enumerate cloud services (IAM, S3, SES), and launched a **phishing campaign** via AWS SES.  

**ğŸ¯ Outcome:** unauthorized use of cloud resources, domain-trusted phishing, increased costs, and elevated organizational risk.  

---

## ğŸ–¼ Attack Flow (ASCII Diagram)

                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   Attacker (External Host)    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚  (stolen Lambda creds)
                               v
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   AWS Lambda Function         â”‚
                â”‚ (compromised, exposed keys)   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               v
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   AWS API Enumeration         â”‚
                â”‚  (IAM, S3, SES discovery)     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚              â”‚
                        â”‚              â”‚
                        v              v
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   IAM Accounts       â”‚   â”‚   S3 Buckets         â”‚
         â”‚ (list users/roles)   â”‚   â”‚ (checked for data)   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        v
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   AWS SES Abuse               â”‚
                â”‚ (phishing via trusted domain) â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               v
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   External Victims            â”‚
                â”‚  (receive phishing emails)    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               v
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   Business Impact             â”‚
                â”‚  - Cloud spend spike          â”‚
                â”‚  - Credential theft risk      â”‚
                â”‚  - Reputation damage          â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

---

## ğŸ“– Attack Narrative

### Stage 1 â€“ Initial Access
- â˜ï¸ **Compromised Lambda credentials** (e.g., leaked keys in code, misconfig).  
- Attacker gains programmatic access into AWS environment.  

### Stage 2 â€“ Enumeration
- Used stolen keys to query **IAM, S3, SES** via AWS API.  
- Discovered mail-sending capability through SES.  

### Stage 3 â€“ Weaponization
- Leveraged AWS SES to send **phishing emails** using the organizationâ€™s legitimate domain.  
- Phishing looked more credible due to trusted mail source.  

### Stage 4 â€“ Impact
- Cloud billing costs increased.  
- Users exposed to phishing â†’ potential credential theft.  
- Organization reputation at risk.  

---

## â±ï¸ Timeline (UTC)

| Time   | Event                                          |
|--------|------------------------------------------------|
| T0     | â˜ï¸ Lambda credentials compromised              |
| T0+1h  | â˜ï¸ AWS API enumeration begins (IAM/S3/SES)     |
| T0+2h  | â˜ï¸ SES misused to send large phishing campaign |
| T0+6h  | â˜ï¸ Cloud spend spike alerts detected           |

---

## ğŸ”‘ Key Findings
- â˜ï¸ **Credentials stored in Lambda code** enabled full compromise.  
- â˜ï¸ **API enumeration** allowed discovery of SES.  
- â˜ï¸ **SES misuse** made phishing appear legitimate.  
- â˜ï¸ **No monitoring** of Lambda â†’ delayed detection.  

---

## ğŸ—‚ï¸ MITRE ATT&CK Mapping
- **T1078** â€“ Valid Accounts (stolen cloud keys)  
- **T1087** â€“ Account Discovery (IAM API calls)  
- **T1530** â€“ Data from Cloud Storage (S3 access attempts)  
- **T1586.002** â€“ Compromise Infrastructure: Email Accounts (SES phishing)  
- **T1567** â€“ Exfiltration over Web Services  

---

## ğŸ‘€ Detection Use Cases
- ğŸš¨ Alert on **SES usage** from Lambda functions that normally donâ€™t send email.  
- ğŸš¨ CloudTrail monitoring for **enumeration-heavy API activity**.  
- â˜ï¸ Billing anomaly alerts for SES / Lambda spikes.  
- â˜ï¸ Monitor access keys tied to serverless functions.  

---

## ğŸ›¡ï¸ Recommendations
- Remove static keys from Lambda â†’ use **IAM roles with least privilege**.  
- Restrict SES sending policies; enable DKIM/DMARC monitoring.  
- Enable **GuardDuty & CloudTrail** to detect anomalous usage.  
- Deploy cost/billing anomaly alerts to flag spikes.  
- Regularly rotate and audit IAM keys.  

---
