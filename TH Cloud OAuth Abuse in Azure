# ğŸ›¡ Demo Case: Cloud OAuth Abuse in Azure (Anonymized)

## ğŸ“Œ Executive Summary
This case describes a **cloud identity attack** via a compromised OAuth app in Azure.  
The attacker minted tokens, enumerated resources, and exfiltrated data from Blob storage, maintaining persistence by registering a new rogue application.  

**ğŸ¯ Outcome:** cloud tenant identity compromise, fast data theft, and persistence.

---

## ğŸ–¼ Attack Flow (ASCII Diagram)

+-------------------------+
| External Attacker       |
| (Internet)              |
+-------------------------+
             |
             v
+-------------------------+
| Compromised OAuth App   |
| (Leaked Secret)         |
+-------------------------+
             |
             v
+-------------------------+
| Token Minting           |
| (Azure AD / Graph API)  |
+-------------------------+
             |
             v
+-------------------------+
| Resource Enumeration    |
| - VM list               |
| - Blob Storage          |
| - KeyVault Secrets      |
+-------------------------+
             |
             v
+-------------------------+
| Data Exfiltration       |
| (Blob â†’ External S3)    |
+-------------------------+
             |
             v
+-------------------------+
| Persistence             |
| Rogue App Registration  |
+-------------------------+

---

## ğŸ“– Attack Narrative

### Stage 1 â€“ Initial Access
- ğŸ”´ OAuth app credentials leaked (client secret).  
- ğŸŸ¡ Attacker minted access tokens via Graph API.  

### Stage 2 â€“ Reconnaissance
- ğŸ”´ Enumerated Azure subscriptions, VM metadata.  
- ğŸŸ¡ Queried KeyVault for sensitive secrets.  

### Stage 3 â€“ Exfiltration & Persistence
- ğŸ”´ Downloaded data from Blob Storage.  
- ğŸŸ¡ Registered new rogue OAuth app â†’ persistence in tenant.  

---

## â±ï¸ Timeline (UTC)

| Time   | Event                                       |
|--------|---------------------------------------------|
| 11:05  | ğŸ”´ OAuth app secret abused â†’ login success   |
| 11:20  | ğŸŸ¡ Tokens minted (Graph API)                 |
| 11:35  | ğŸ”´ Resource enumeration (VMs, Blob, KeyVault)|
| 11:50  | ğŸ”´ Blob dump â†’ exfiltration                  |
| 12:15  | ğŸŸ¡ Rogue app registered for persistence      |

---

## ğŸ”‘ Key Findings
- OAuth credential theft â†’ full tenant compromise.  
- Exfiltration within 1 hour of initial access.  
- Persistence ensured via app registration.  

---

## ğŸ—‚ï¸ MITRE ATT&CK Mapping
- **T1528 â€“ Steal Application Access Token**  
- **T1078 â€“ Valid Accounts (Cloud Identity)**  
- **T1530 â€“ Data from Cloud Storage**  
- **T1136.003 â€“ Create Account (Cloud App Registration)**  

---

## ğŸ‘€ Detection Use Cases
- Alert on anomalous OAuth token minting.  
- Detect new app registrations outside change windows.  
- Monitor Graph API queries for Blob + KeyVault.  

---

## ğŸ›¡ï¸ Recommendations
- Rotate OAuth secrets & enforce certificate auth.  
- Require MFA for app management.  
- Monitor Azure AD Sign-In + Graph API logs.  
- Implement least-privilege for service principals.
