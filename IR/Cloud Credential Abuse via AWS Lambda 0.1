ğŸ“Œ Executive Summary

This case describes a cloud-focused compromise.
The attacker obtained exposed AWS Lambda credentials, used them to enumerate cloud services (IAM, S3, SES), and launched a phishing campaign via AWS SES.

ğŸ¯ Outcome: unauthorized use of cloud resources, domain-trusted phishing, increased costs, and elevated organizational risk.

___________________________________________________________________________________________________________________

ğŸ–¼ Attack Flow
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Attacker (External Host)    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚  (stolen Lambda creds)
                           v
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   AWS Lambda Function         â”‚
            â”‚ (compromised, exposed keys)   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           v
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   AWS API Enumeration         â”‚
            â”‚  (IAM, S3, SES discovery)     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚              â”‚
                    â”‚              â”‚
                    v              v
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   IAM Accounts       â”‚   â”‚   S3 Buckets         â”‚
     â”‚ (list users/roles)   â”‚   â”‚ (checked for data)   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    v
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   AWS SES Abuse               â”‚
            â”‚ (phishing via trusted domain) â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           v
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   External Victims            â”‚
            â”‚  (receive phishing emails)    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           v
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Business Impact             â”‚
            â”‚  - Cloud spend spike          â”‚
            â”‚  - Credential theft risk      â”‚
            â”‚  - Reputation damage          â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
___________________________________________________________________________________________________________________

ğŸ“– Attack Narrative
ğŸ¥· Stage 1 â€“ Initial Access

â˜ï¸ Compromised Lambda credentials (e.g., leaked keys in code, misconfig).

Attacker gains programmatic access into AWS environment.

ğŸ” Stage 2 â€“ Enumeration

Used stolen keys to query IAM, S3, SES via AWS API.

Discovered mail-sending capability through SES.

ğŸ¯ Stage 3 â€“ Weaponization

Leveraged AWS SES to send phishing emails using the organizationâ€™s legitimate domain.

Phishing looked more credible due to trusted mail source.

ğŸ’¥ Stage 4 â€“ Impact

Cloud billing costs increased.

Users exposed to phishing â†’ potential credential theft.

Organization reputation at risk.
___________________________________________________________________________________________________________________
â±ï¸ Timeline (UTC)

| Time  | Event                                          |
| ----- | ---------------------------------------------- |
| T0    | â˜ï¸ Lambda credentials compromised              |
| T0+1h | â˜ï¸ AWS API enumeration begins (IAM/S3/SES)     |
| T0+2h | â˜ï¸ SES misused to send large phishing campaign |
| T0+6h | â˜ï¸ Cloud spend spike alerts detected           |
___________________________________________________________________________________________________________________

ğŸ”‘ Key Findings

â˜ï¸ Credentials stored in Lambda code enabled full compromise.

â˜ï¸ API enumeration allowed discovery of SES.

â˜ï¸ SES misuse made phishing appear legitimate.

â˜ï¸ No monitoring of Lambda â†’ delayed detection.
___________________________________________________________________________________________________________________

ğŸ—‚ï¸ MITRE ATT&CK Mapping

ğŸ­ T1078 â€“ Valid Accounts (stolen cloud keys)

ğŸ” T1087 â€“ Account Discovery (IAM API calls)

ğŸ“¦ T1530 â€“ Data from Cloud Storage (S3 access attempts)

ğŸ“§ T1586.002 â€“ Compromise Infrastructure: Email Accounts (SES phishing)

ğŸ“¤ T1567 â€“ Exfiltration over Web Services
___________________________________________________________________________________________________________________

ğŸ“‚ Artifacts (Synthetic / Anonymized)

{
  "eventTime": "2025-07-21T10:58:17Z",
  "eventSource": "ses.amazonaws.com",
  "eventName": "SendEmail",
  "awsRegion": "us-east-1",
  "userIdentity": {
    "type": "IAMUser",
    "accessKeyId": "AKIA********DEMO",
    "accountId": "111122223333",
    "arn": "arn:aws:iam::111122223333:user/lambda-svc"
  },
  "requestParameters": {
    "destination": {
      "toAddresses": ["user1@external-example.net","user2@external-example.net"]
    },
    "source": "notify@mail.example.org",
    "message": {
      "subject": {"data":"Password Reset Notice"},
      "body": {"text": {"data":"Please confirm your account at https://login.example.org/reset"}}
    }
  },
  "sourceIPAddress": "203.0.113.45"
}


{
  "eventTime": "2025-07-21T10:41:03Z",
  "eventSource": "iam.amazonaws.com",
  "eventName": "ListUsers",
  "userIdentity": { "accessKeyId": "AKIA********DEMO" },
  "sourceIPAddress": "203.0.113.45"
}


{
  "eventTime": "2025-07-21T10:46:29Z",
  "eventSource": "lambda.amazonaws.com",
  "eventName": "ListFunctions",
  "userIdentity": { "accessKeyId": "AKIA********DEMO" },
  "sourceIPAddress": "203.0.113.45"
}
___________________________________________________________________________________________________________________


ğŸ’» Attacker Commands (Reconstructed, Synthetic)

# Enumerate IAM identities
aws iam list-users --profile compromised
aws iam list-roles  --profile compromised

# Check Lambda inventory
aws lambda list-functions --region us-east-1 --profile compromised

# Probe SES capability
aws ses get-send-quota      --profile compromised
aws ses list-identities     --profile compromised

# Send phishing via SES (synthetic example)
aws ses send-email \
  --from notify@mail.example.org \
  --destination ToAddresses=user1@external-example.net \
  --message Subject.Data="Password Reset Notice",Body.Text.Data="Visit https://login.example.org/reset" \
  --profile compromised
___________________________________________________________________________________________________________________

ğŸ§¾ IOCs (Synthetic)

| Type      | Value                                                              | Source          | Status    |
| --------- | ------------------------------------------------------------------ | --------------- | --------- |
| ğŸŒ IP     | 203.0.113.45                                                       | CloudTrail      | Malicious |
| ğŸ‘¤ ARN    | arn\:aws\:iam::111122223333\:user/lambda-svc                       | CloudTrail      | Abused    |
| ğŸ“§ Sender | [notify@mail.example.org](mailto:notify@mail.example.org)          | SES logs        | Abused    |
| ğŸ”— URL    | [https://login.example.org/reset](https://login.example.org/reset) | Phish content   | Malicious |
| ğŸ”‘ AKIA   | AKIA\*\*\*\*\*\*\*\*DEMO                                           | Lambda env dump | Disabled  |
___________________________________________________________________________________________________________________


ğŸ‘€ Detection Use Cases

ğŸš¨ Alert on SES usage from Lambda functions that normally donâ€™t send email.

ğŸš¨ CloudTrail monitoring for enumeration-heavy API activity.

â˜ï¸ Billing anomaly alerts for SES / Lambda spikes.

â˜ï¸ Monitor access keys tied to serverless functions.
___________________________________________________________________________________________________________________

ğŸ›¡ï¸ Response Actions

âŒ Disabled exposed access key (AKIA********DEMO) and rotated all Lambda secrets.

ğŸ“§ Blocked SES sending from notify@mail.example.org; reviewed SES identities and policies.

ğŸ” Queried CloudTrail for all activity from 203.0.113.45 and the abused IAM user lambda-svc.

ğŸ“œ Enabled CloudTrail Data Events for Lambda; added GuardDuty detections for unusual SES spikes.

ğŸ”’ Implemented least-privilege on Lambda roles; moved secrets to AWS Secrets Manager.
___________________________________________________________________________________________________________________

ğŸ›¡ï¸ Recommendations

ğŸ”‘ Remove static keys from Lambda â†’ use IAM roles with least privilege.

ğŸ“§ Restrict SES sending policies; enable DKIM/DMARC monitoring.

ğŸš¨ Enable GuardDuty & CloudTrail to detect anomalous usage.

ğŸ’° Deploy cost/billing anomaly alerts to flag spikes.

ğŸ”„ Regularly rotate and audit IAM keys.
