# ğŸ›¡ Demo Case: Multi-Stage Compromise (Anonymized)

## ğŸ“Œ Executive Summary
This case shows a **multi-stage compromise** across two Linux servers (`10.0.0.7` and `10.0.0.6`).  
The attacker first created unauthorized accounts and deployed **Sliver C2** on Host A.  
They then **brute-forced FTP** on Host B, pivoted via SSH, deployed a custom backdoor (`UPSET_RHYTHM`), executed a disguised Trojan (`vsftpd.jpg`), and attempted **anti-forensics** with container tampering (`runc delete --force`).  

**ğŸ¯ Outcome:** confirmed C2 activity, lateral movement, brute-force credential abuse, persistence, and cleanup attempts.  

---

## ğŸ–¼ Attack Flow (ASCII Diagram)

                   +-------------------+
                   |  External Attacker|
                   +-------------------+
                            |
                            v
                   +-------------------+
                   | Host A (10.0.0.7) |
                   +-------------------+
                      |         |
       curl Sliver    |         | hydra brute-force FTP
         +            |         v
         |            |   +-------------------+
         |            |   | Host B (10.0.0.6) |
         |            |   +-------------------+
         |            |           |
         |            |           â”œâ”€â”€ ğŸŸ¢ nohup ./UPSET_RHYTHM & (persistence)
         |            |           â”œâ”€â”€ ğŸ”´ exec ./vsftpd.jpg (Trojan)
         |            |           â”œâ”€â”€ ğŸŸ¡ gobuster dir â€¦ (recon)
         |            |           â””â”€â”€ ğŸŸ¡ runc delete --force (tampering)
         |
   Unauthorized user (ubuntu)
   Sliver C2 channel established
   SSH pivot as cooluser

---

## ğŸ“– Attack Narrative

### Stage 1 â€“ Foothold on Host A (10.0.0.7)
- ğŸ”´ `useradd ubuntu` â†’ unauthorized user creation.  
- ğŸ”´ `curl -o sliver-client_linux` â†’ download of Sliver C2.  
- ğŸ”´ `chmod +x sliver-client_linux` â†’ prepared for execution.  
- ğŸ”´ C2 channel likely established with attacker IP.  

### Stage 2 â€“ Credential Access & Pivot
- ğŸŸ¡ `hydra -l root -P wordlist.txt ftp://10.0.0.6` â†’ brute-force attempt.  
- ğŸŸ¡ Successful **SSH login** as `cooluser` into Host B.  

### Stage 3 â€“ Post-Exploitation on Host B (10.0.0.6)
- ğŸŸ¢ `curl -s ... -o UPSET_RHYTHM` â†’ payload retrieval.  
- ğŸŸ¢ `nohup ./UPSET_RHYTHM &` â†’ persistence mechanism.  
- ğŸ”´ Execution of **Trojan disguised as `vsftpd.jpg`** (detected by 30+ AV engines).  
- ğŸŸ¡ `gobuster dir` â†’ reconnaissance of local services.  
- ğŸŸ¡ `runc delete --force` â†’ container tampering (cleanup/anti-forensics).  

---

## â±ï¸ Timeline (UTC)

| Time       | Event                                                       |
|------------|-------------------------------------------------------------|
| 19:08      | ğŸ”´ `useradd ubuntu` (Host A)                                |
| 19:10â€“13   | ğŸ”´ Sliver client downloaded & prepared                      |
| 19:17      | ğŸŸ¡ `runc delete --force` (Host B)                           |
| 19:24      | ğŸŸ¡ `hydra` brute-force FTP (Host A â†’ B)                     |
| 19:49      | ğŸŸ¡ SSH login as `cooluser` (Host B)                         |
| 19:58â€“20:03| ğŸŸ¢ UPSET_RHYTHM persistence & Trojan execution (Host B)     |
| 20:04      | ğŸŸ¢ `gobuster` enumeration + cleanup activity                |

---

## ğŸ”‘ Key Findings
- ğŸ”´ **Foothold:** unauthorized users (`ubuntu`, `cooluser`)  
- ğŸ”´ **C2:** Sliver client retrieved & executed  
- ğŸŸ¡ **Credential access:** brute-force against FTP service  
- ğŸŸ¡ **Lateral movement:** SSH pivot  
- ğŸŸ¢ **Persistence:** custom payload (`UPSET_RHYTHM`, `nohup`)  
- ğŸ”´ **Malware:** Trojan disguised as `vsftpd.jpg`  
- ğŸŸ¡ **Recon:** `gobuster` scanning internal web  
- ğŸŸ¡ **Tampering:** container deletion (`runc delete --force`)  

---

## ğŸ—‚ï¸ MITRE ATT&CK Mapping
- **T1136 â€“ Create Account** (ubuntu, cooluser)  
- **T1059 â€“ Command Shell** / **T1204 â€“ User Execution** (Sliver execution)  
- **T1110 â€“ Brute Force** (hydra)  
- **T1021.004 â€“ SSH** (pivot)  
- **T1053 â€“ Scheduled/Background Task** (nohup persistence)  
- **T1071 â€“ Application Layer Protocol** (Sliver C2)  
- **T1070 â€“ Indicator Removal** / **T1562 â€“ Impair Defenses** (runc delete)  
- **T1046 â€“ Network Service Scanning** (gobuster)  

---

## ğŸ‘€ Detection Use Cases
- ğŸš¨ Alert on unexpected **`useradd`**.  
- ğŸš¨ Detect **curl â†’ chmod â†’ exec** process chains in `/tmp`.  
- ğŸŸ¡ Flag multiple FTP failures followed by success.  
- ğŸŸ¡ Watch for new accounts logging into SSH (`cooluser`).  
- ğŸ”´ Detect suspicious binaries (`sliver*`, `vsftpd.jpg`).  
- ğŸŸ¡ Monitor abnormal **container lifecycle** events (`runc delete --force`).  

---

## ğŸ›¡ï¸ Recommendations
- Block attacker IOCs (hashes, external IPs).  
- Enforce MFA & key-based SSH; disable root login.  
- Improve logging: `auditd` for `execve`, `useradd`, containers.  
- Rate-limit & monitor FTP/SSH services.  
- Harden segmentation between critical hosts.  
- Add detections for **Sliver / UPSET_RHYTHM** in SIEM & EDR hunts.  
